---
category:
- Geek
creator: admin
date: 2016-12-20T00:31:46
layout: layout.njk
permalink: /2016/12/19/mac-randomizer-alfred-script/
tags:
- Alfred
- macOS
- Networking
- Python
title: MAC Randomizer Alfred Script
type: post
wp_id: "2715"
---
<p>A recent conversation I had dealt with free wifi that limited the amount of time you could use it before it kicked you off.  Now, while I support the right of wifi providers to do as they please, it's an interesting question.  AFAIK most tracking of that sort is done based on MAC addresses, which you can easily spoof if you want.</p>

<p>I wrote up a quick Alfred workflow that shells out from Python to do the real work.  Note that if your wifi interface isn't called <code>en0</code> this won't work for you.</p>

<p style="text-align: center;"><img src="//static.velvetcache.org/pages/2016/12/19/mac-randomizer-alfred-script/workflow.png" alt="Workflow Overview" /></p>

<p>The first script shells out to <code>ifconfig</code> to get the current address. Which gives output like the following.  We are interested in that <code>ether f4:5c:89:b3:37:e1</code> line.  The first three octets are of a MAC are the Organizationally Unique Identifier (OUI) and we don't need to change those, what we have is valid already.</p>
<p><pre lang="text" line="0">en0: flags=8863<UP,BROADCAST,SMART,RUNNING,SIMPLEX,MULTICAST> mtu 1500
	ether f4:5c:89:b3:37:e1
	inet6 fe80::8da:f24a:a0bb:3b7a%en0 prefixlen 64 secured scopeid 0x4
	inet 192.168.1.126 netmask 0xffffff00 broadcast 192.168.1.255
	nd6 options=201<PERFORMNUD,DAD>
	media: autoselect
	status: active</pre></p>
<p>Our script captures the OUI, then generates three more octets for the rest of the address, and prints it out.</p>
<pre lang="python">from subprocess import check_output
from re import compile
from random import randint

MATCHER = compile("\W*ether ([a-f0-9]{2}:[a-f0-9]{2}:[a-f0-9]{2}:[a-f0-9]{2}:[a-f0-9]{2}:[a-f0-9]{2})")
output = check_output(["ifconfig", "en0"])

mac = None

for line in output.split("\n"):
    match = MATCHER.match(line)
    if match is not None:
        mac = match.groups()[0]
        break

prefix = mac[:8]

print "%s:%x:%x:%x" % (prefix, randint(0, 255), randint(0, 255), randint(0, 255))</pre></p>
<p>Next we need to actually set this new random MAC.  This is a privileged operation, so it we passed it directly to <code>ifconfig</code> it would error out.  Long story short, if we want a nice authorization dialog we have to pass through applescript, russian nesting doll style.</p>

<p><pre lang="bash">osascript -e  "do shell script \"sudo ifconfig en0 ether {query} >/dev/null;\" with administrator privileges"</pre></p>

<p>I also added a way to reset it to the hardware value.  The <code>networksetup</code> command handily has that for the taking.  We just shell out, capture it and pass it through to <code>ifconfig</code> again.</p>

<p><pre lang="python">from subprocess import check_output
from re import compile

MATCHER = compile("Ethernet Address: ([a-f0-9]{2}:[a-f0-9]{2}:[a-f0-9]{2}:[a-f0-9]{2}:[a-f0-9]{2}:[a-f0-9]{2})")
output = check_output(["networksetup", "-getmacaddress", "en0"])
match = MATCHER.match(output)
print match.groups()[0]</pre></p>

<p>You can <a href="http://static.velvetcache.org/pages/2016/12/19/mac-randomizer-alfred-script/MAC%20Changer.alfredworkflow">download this workflow</a>, comments and improvements appreciated.</p>